---
title: "Data assembly"
author: "Carole Voulgaris"
date: "1/20/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE, results='hide'}
options(java.parameters = '-Xmx2G')

library(tidyverse)
library(sf)
library(fs)
library(lubridate)
library(psych)
library(nFactors)
library(tigris)
library(r5r)
library(here)
library(arrow)
```



Check if factor analysis would be okay

```{r}
full_data <- read_parquet("assembled-data/easy-data.parquet") %>%
  inner_join(read_parquet("assembled-data/parcel-access.parquet")) %>%
  inner_join(read_parquet("assembled-data/loan-data.parquet")) 

factor_data <- full_data %>% 
  select(-PARID, -GEOID, -id)
  
KMO(factor_data)
```
KMO is greater than 0.6, so factor analysis is okay

```{r}
cortest.bartlett(factor_data)
```

p-value is zero, so factors analysis is okay

Take a guess at the right number of factors

```{r}
parallel <- fa.parallel(factor_data)
```

Do principal component analysis and factor analysis with different numbers of factors (as low as 5, as high as the recommended number) and each possible rotation:

* "none"
* "varimax"
* "quartimax"
* "bentlerT"
* "equamax"
* "varimin"
* "geominT"
* "bifactor"
* "Promax"
* "promax"
* "oblimin"
* "simplimax"
* "bentlerQ"
* "geominQ"
* "biquartimin"
* "cluster"

Identify the best-fitting 

```{r}
pca <- pca(factor_data, 
              nfactors = 9,
              rotate = "none") 

pca$fit
```


```{r}
fa <- fa(factor_data, 
              nfactors = 11,
              rotate = "none") 

fa$BIC
```





